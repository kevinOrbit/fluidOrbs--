<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>æµä½“å…‰æ„Ÿç”Ÿæˆå™¨-@Kaimana</title>
<script src="https://cdn.tailwindcss.com"></script>
    <!-- å¼•å…¥æˆªå›¾åº“ html2canvas -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<style>
    :root {
        --bg-color: #f5f5f7;
        --text-color: #1d1d1f;
        --panel-bg: rgba(255, 255, 255, 0.9);
        --panel-shadow: 0 -10px 40px rgba(0,0,0,0.1);
        
        /* é¼ æ ‡è§†å·®å˜é‡ */
        --mx: 0;
        --my: 0;
        
        /* é»˜è®¤çƒä½“å¤§å° */
        --blob-size: 115px;
    }

    body.dark-mode  {
        --bg-color: #050505;
        --text-color: #f0f0f0;
        --panel-bg: rgba(30, 30, 30, 0.9);
        --panel-shadow: 0 -10px 40px rgba(0,0,0,0.6);
    }
    
    body.dark-mode .text-display-optimized {
        color: white !important;
    }

    body {
        background: var(--bg-color);
        color: var(--text-color);
        margin: 0;
        padding: 35px;
        font-family: 'SF Pro Display', system-ui, -apple-system, sans-serif;
        display: flex;
        flex-direction: column;
        align-items: center;
        transition: background 0.5s ease, color 0.5s ease;
        min-height: 100vh;
        overflow-x: hidden;
        /* é˜²æ­¢ç§»åŠ¨ç«¯ä¸‹æ‹‰åˆ·æ–°å½±å“æ‹–æ‹½ä½“éªŒ */
        overscroll-behavior-y: none; 
    }

    /* === é¡¶éƒ¨æ ‡é¢˜åŒºåŸŸ === */
    header {
        position: relative;
        z-index: 10;
        margin-bottom: 20px;
    }

    /* === ç½‘æ ¼å¸ƒå±€ === */
    .grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 30px;
        max-width: 1000px;
        width: 100%;
        justify-items: center;
        /* åº•éƒ¨ç•™ç™½ï¼Œé˜²æ­¢è¢«æ§åˆ¶é¢æ¿é®æŒ¡ */
        padding-bottom: 180px; 
        perspective: 1000px;
    }

    @media (min-width: 640px) {
        .grid { grid-template-columns: repeat(3, 1fr); padding-bottom: 160px; }
    }
    @media (min-width: 768px) {
        .grid { grid-template-columns: repeat(4, 1fr); }
    }
    @media (max-width: 639px) {
        :root { --blob-size: 150px; }
        .grid { 
            grid-template-columns: repeat(2, 1fr) !important; 
            gap: 20px; 
            padding: 0 10px 200px; /* å¢åŠ åº•éƒ¨ç•™ç™½ */
        }
        
        /* æ ‡é¢˜é€‚é… */
        #title-display { font-size: 1.6rem; letter-spacing: -1.3px; }
        #text-display { font-size: 0.9rem;  letter-spacing: -0.3px; }
    }
    

    /* === æ ¸å¿ƒçƒä½“æ ·å¼ === */
    .blob {
        width: var(--blob-size);
        height: var(--blob-size);
        border-radius: 50%;
        background-size: 200% 200%;
        position: relative;
        cursor: pointer; 
        transition: transform 0.2s cubic-bezier(0.25, 0.46, 0.45, 0.94), width 0.2s, height 0.2s;
        filter: blur(1px) contrast(1.5);
        box-shadow: 
            inset calc(var(--mx) * -20px) calc(var(--my) * -20px) 30px rgba(255,255,255,0.6), 
            inset calc(var(--mx) * 20px) calc(var(--my) * 20px) 30px rgba(0,0,0,0.15),
            0 15px 35px rgba(0,0,0,0.15);
        
        /* ç¦ç”¨è§¦æ‘¸æ—¶çš„é»˜è®¤é«˜äº® */
        -webkit-tap-highlight-color: transparent;
    }

    .blob:hover {
        transform: scale(1.05) translateY(-5px);
        z-index: 10;
    }
    .blob:active {
        transform: scale(0.95);
    }

    /* å™ªç‚¹çº¹ç† */
    .blob::after {
        content: "";
        position: absolute;
        inset: -10%;
        width: 100%; height: 100%;
        background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.7' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='0.15'/%3E%3C/svg%3E");
        opacity: 0.2;
        mix-blend-mode: overlay;
        pointer-events: none;
        animation: noiseMove 4s steps(10) infinite;
    }

    /* === å¼¥æ•£æ¨¡å¼ === */
    .grid.diffusion-active .blob {
        filter: blur(1.5px) contrast(2);
        box-shadow: none; 
    }
    .grid.diffusion-active .blob::after { opacity: 0.1; }

    @keyframes spin { 
        0% { transform: rotate(0deg); } 
        100% { transform: rotate(360deg); } 
    }
    /* === æ–°å¢ï¼šå‘¼å¸åŠ¨ç”» === */
    /* ä½¿ç”¨ scale å±æ€§è€Œé transformï¼Œé¿å…å†²çª */
    @keyframes breathe {
        0%, 100% { scale: 1; }
        50% { scale: 1.08; } /* å‘¼å¸å¹…åº¦ï¼š1.0 -> 1.08 -> 1.0 */
    }

    /* å®šä¹‰å‘¼å¸å˜é‡ï¼šé»˜è®¤ 'none' (ä¸å‘¼å¸) */
    :root {
        --breath-anim-name: none;
    }
    /* å½“ Grid è¢«æ¿€æ´»å‘¼å¸æ¨¡å¼æ—¶ï¼Œå˜é‡å˜ä¸ºåŠ¨ç”»å */
    .grid.breath-active {
        --breath-anim-name: breathe;
    }
    /* === æ§åˆ¶é¢æ¿ (åŸºç¡€æ ·å¼) === */
    .controls {
        position: fixed;
        bottom: 20px;
        background: var(--panel-bg);
        backdrop-filter: blur(20px);
        -webkit-backdrop-filter: blur(20px);
        padding: 18px 24px;
        border-radius: 24px;
        box-shadow: var(--panel-shadow);
        display: flex;
        flex-wrap: wrap;
        gap: 20px;
        align-items: center;
        z-index: 100;
        border: 1px solid rgba(128,128,128,0.15);
        max-width: 95%;
        justify-content: center;
        transition: transform 0.4s cubic-bezier(0.2, 0.8, 0.2, 1);
    }

    /* æ‹–æ‹½æ‰‹æŸ„ - é»˜è®¤éšè— (æ¡Œé¢ç«¯) */
    .drag-handle-area {
        display: none;
    }

    /* === ç§»åŠ¨ç«¯åº•éƒ¨æŠ½å±‰æ ·å¼ (æ ¸å¿ƒé€»è¾‘) === */
    @media (max-width: 639px) {
        .controls {
            /* è´´åº•å¸ƒå±€ */
            bottom: 0;
            left: 0;
            right: 0;
            max-width: 100%;
            width: 100%;
            border-radius: 28px 28px 0 0;
            padding: 0 24px 3px 24px; /* åº•éƒ¨å¢åŠ  padding é€‚é… iPhone Home æ¡ */
            border: none;
            border-top: 1px solid rgba(255,255,255,0.2);
            
            /* å¸ƒå±€æ”¹ä¸ºçºµå‘ */
            flex-direction: column;
            align-items: stretch;
            gap: 15px;

            /* åˆå§‹çŠ¶æ€ï¼šå‘ä¸‹åç§»ï¼Œåªç•™å‡ºé¡¶éƒ¨ 40px */
            /* ä½¿ç”¨ JS åŠ¨æ€è®¡ç®—æ›´å‡†ç¡®ï¼Œè¿™é‡Œä½œä¸ºå…œåº• */
            transform: translateY(calc(100% - 44px)); 
            
            /* æå‡å±‚çº§ */
            z-index: 999;
        }

        /* æ‹–æ‹½æ‰‹æŸ„åŒºåŸŸ */
        .drag-handle-area {
            display: flex;
            width: 100%;
            height: 44px; /* ç‚¹å‡»/æ‹–æ‹½åŒºåŸŸé«˜åº¦ */
            justify-content: center;
            align-items: center;
            cursor: grab;
            margin-bottom: 5px;
            flex-shrink: 0;
            /* å¢åŠ è§¦æ‘¸çƒ­åŒº */
            margin-top: -10px;
            padding-top: 10px;
        }

        /* è§†è§‰ä¸Šçš„ç°è‰²çŸ­æ¨ªçº¿ */
        .drag-pill {
            width: 36px;
            height: 5px;
            background-color: rgba(128, 128, 128, 0.3);
            border-radius: 10px;
            pointer-events: none;
        }

        /* å†…éƒ¨å…ƒç´ é€‚é… */
        .control-item {
            width: 100%;
            flex-direction: row; /* æ‰‹æœºä¸Šå°½é‡è®© label å’Œ input åœ¨ä¸€è¡Œ */
            justify-content: space-between;
            align-items: center;
        }
        
        /* ç‰¹æ®Šå¤„ç†é¢œè‰²é€‰æ‹©å™¨ */
        .control-item:first-of-type {
            flex-direction: column;
            align-items: flex-start;
        }
        .control-item:first-of-type .color-group {
            width: 100%;
            justify-content: flex-start;
            margin-top: 8px;
        }

        .toggle-group {
            flex-direction: row;
            justify-content: space-between;
            width: 100%;
        }

        button {
            width: 100%;
            padding: 16px;
            font-size: 1rem;
            margin-top: 10px;
        }
    }

    /* é€šç”¨æ§ä»¶æ ·å¼ */
    .control-item label {
        font-size: 0.8rem;
        font-weight: 600;
        opacity: 0.7;
        letter-spacing: 0.5px;
    }

    .color-group { display: flex; gap: 12px; align-items: center; }
    
    .color-input-wrapper { 
        display: flex;           /* å…³é”®ï¼šå¼€å¯å¼¹æ€§å¸ƒå±€ */
        align-items: center;     /* å…³é”®ï¼šè®©å†…éƒ¨çš„é¢œè‰²çƒå‚ç›´å±…ä¸­ */
        transition: 0.3s; overflow: hidden; 
    
    }
    .color-input-wrapper.hidden { width: 0; opacity: 0; margin: 0;}
    
    input[type="color"] {
        border: none; background: none; height: 40px; width: 40px;
        border-radius: 50%; cursor: pointer; padding: 0;
        /* å¢åŠ åœ†è§’é®ç½©ï¼Œé€‚é… Webkit */
        -webkit-appearance: none;
    }
    input[type="color"]::-webkit-color-swatch-wrapper { padding: 0; }
    input[type="color"]::-webkit-color-swatch { border: none; border-radius: 50%; border: 2px solid rgba(0,0,0,0.1); }

    input[type="range"] {
        width: 115px;
        accent-color: var(--text-color);
    }
    @media (max-width: 639px) { input[type="range"] { width: 50%; } }

    .toggle-switch { display: flex; align-items: center; gap: 8px; font-size: 0.85rem; font-weight: 600; }
    
    button {
        padding: 12px 24px;
        border-radius: 14px;
        background: var(--text-color);
        color: var(--bg-color);
        border: none;
        font-weight: 600;
        cursor: pointer;
        transition: transform 0.1s;
    }
    button:active { transform: scale(0.96); }

    /* Toast */
    #toast {
        position: fixed;
        top: 30px; left: 50%; transform: translateX(-50%) translateY(-20px);
        background: rgba(0,0,0,0.8); color: white;
        padding: 12px 24px; border-radius: 50px;
        font-size: 0.9rem; opacity: 0; pointer-events: none;
        transition: 0.3s; z-index: 200; backdrop-filter: blur(5px);
    }
    #toast.show { transform: translateX(-50%) translateY(0); opacity: 1; }
</style>
</head>
<body>

<header id="gradient-display" class="flex flex-col items-center justify-center p-3">
    <div id="title-display" class="text-black text-2xl md:text-4xl font-bold tracking-wider transition-opacity duration-500 text-display-optimized">
    Fluid Orbs-å…‰æº¯
    </div>
  <div id="text-display" class="subtitle text-black text-sm md:text-sm font-bold tracking-wider transition-opacity duration-500 text-display-optimized mt-1">
    @Kaimana
  </div>
</header>

<div class="grid" id="grid"></div>

<div id="toast">âœ… CSS å·²å¤åˆ¶</div>

<!-- æ§åˆ¶é¢æ¿ -->
<div class="controls" id="controlPanel">
    <!-- ç§»åŠ¨ç«¯æ‹–æ‹½æŠŠæ‰‹ -->
    <div class="drag-handle-area" id="dragHandle">
        <div class="drag-pill"></div>
    </div>
    
    <!-- 1. é¢œè‰²æ§åˆ¶ -->
    <div class="control-item">
        <div style="display:flex; justify-content:space-between; width:100%;">
            <label>é…è‰²æ–¹æ¡ˆ</label>
            <label class="toggle-switch" style="font-size: 0.75rem;">
                <input type="checkbox" id="dualColorToggle"> åŒè‰²æ¨¡å¼
            </label>
        </div>
        <div class="color-group">
            <input type="color" id="colorPicker1" value="#4477ff">
            <div class="color-input-wrapper hidden" id="colorInput2Wrapper">
                <input type="color" id="colorPicker2" value="#ff44aa">
            </div>
        </div>
    </div>

    <!-- 2. åå·®æ§åˆ¶ -->
    <div class="control-item">
        <label>è‰²å½©åå·®</label>
        <input type="range" id="varianceRange" min="0" max="100" value="55">
    </div>
    <!-- ã€æ–°å¢åŠŸèƒ½ 1ã€‘ï¼šæ•°é‡æ§åˆ¶ -->
    <div class="control-item">
        <label>çƒä½“æ•°é‡ <span id="countVal" style="font-family:monospace; margin-left:5px; opacity:0.6;">12</span></label>
        <input type="range" id="countRange" min="4" max="16" value="6">
    </div>
    <!-- 3. å¤§å°æ§åˆ¶ -->
    <div class="control-item">
        <label>å¤§å° <span id="sizeVal" style="font-family:monospace; margin-left:5px; opacity:0.6;">115px</span></label>
        <input type="range" id="sizeRange" min="90" max="250" value="115">
    </div>

    <!-- 4. å¼€å…³ç»„ -->
    <div class="toggle-group" style="display:flex; justify-content:space-between; width:100%;"  >
        <label class="toggle-switch">
            <input type="checkbox" id="diffusionToggle">
            å¼¥æ•£æ¨¡å¼
        </label>
        <label class="toggle-switch">
            <input type="checkbox" id="darkModeToggle">
            æ·±è‰²èƒŒæ™¯
        </label>
        <!-- æ–°å¢ï¼šå‘¼å¸å¼€å…³ -->
        <label class="toggle-switch">
            <input type="checkbox" id="breathToggle">
            å‘¼å¸æ•ˆæœ
        </label>
    </div>

    <button onclick="regenerate()" style="border-bottom:1px solid var(--text-color); color:var(--text-color); margin-top:0px;" >âœ¨ é‡æ–°ç”Ÿæˆ</button>
        <!-- ã€æ–°å¢åŠŸèƒ½ 2ã€‘ï¼šå¯¼å‡ºæŒ‰é’® (æ ·å¼è®¾ä¸ºé€æ˜è¾¹æ¡†ï¼Œä»¥ç¤ºåŒºåˆ†) -->
    <!-- <button onclick="exportImage()" style="border-bottom:1px solid var(--text-color); color:var(--text-color); margin-top:0px;" >
        ğŸ“· å¯¼å‡ºå›¾ç‰‡
    </button> -->
        <!-- style="background:transparent; border:2px solid var(--text-color); color:var(--text-color); margin-top:0px;" -->

</div>

<!-- é®ç½©å±‚ (ç§»åŠ¨ç«¯å±•å¼€æ—¶æ˜¾ç¤º) -->
<div id="backdrop" style="position:fixed; inset:0; background:rgba(0,0,0,0.3); z-index:90; opacity:0; pointer-events:none; transition:opacity 0.3s;"></div>

<script>
/* ----------------- 1. ç§»åŠ¨ç«¯æŠ½å±‰é€»è¾‘ (Bottom Sheet) ----------------- */
const panel = document.getElementById('controlPanel');
const handle = document.getElementById('dragHandle');
const backdrop = document.getElementById('backdrop');

let startY = 0;
let currentY = 0;
let isDragging = false;
let isOpen = false; 

// ä»…åœ¨ç§»åŠ¨ç«¯åˆå§‹åŒ–
function initMobileSheet() {
    if (window.innerWidth > 655) {
        panel.style.transform = '';
        return;
    }
    
    // åˆå§‹åŒ–æ”¶èµ·çŠ¶æ€
    togglePanel(false);
}

// åˆ‡æ¢é¢æ¿çŠ¶æ€
function togglePanel(open) {
    isOpen = open;
    if (window.innerWidth > 655) return; // æ¡Œé¢ç«¯ä¸å¤„ç†

    if (open) {
        panel.style.transform = `translateY(0px)`;
        backdrop.style.opacity = '1';
        backdrop.style.pointerEvents = 'auto';
    } else {
        // è®¡ç®—æ”¶èµ·ä½ç½®ï¼šæ€»é«˜åº¦ - æŠŠæ‰‹é«˜åº¦(44px)
        const offset = panel.offsetHeight - 44;
        panel.style.transform = `translateY(${offset}px)`;
        backdrop.style.opacity = '0';
        backdrop.style.pointerEvents = 'none';
    }
}

// ç»‘å®šè§¦æ‘¸äº‹ä»¶
handle.addEventListener('click', () => togglePanel(!isOpen));
backdrop.addEventListener('click', () => togglePanel(false)); // ç‚¹å‡»èƒŒæ™¯å…³é—­

handle.addEventListener('touchstart', (e) => {
    isDragging = true;
    startY = e.touches[0].clientY;
    panel.style.transition = 'none'; // æ‹–æ‹½æ—¶ç§»é™¤åŠ¨ç”»
}, { passive: true });

handle.addEventListener('touchmove', (e) => {
    if (!isDragging) return;
    const currentY = e.touches[0].clientY;
    const deltaY = currentY - startY;
    
    const panelHeight = panel.offsetHeight;
    const closedOffset = panelHeight - 44;
    
    let newTranslateY;

    if (isOpen) {
        // å±•å¼€çŠ¶æ€ä¸‹å‘ä¸‹æ‹‰ï¼šdeltaY > 0
        newTranslateY = deltaY;
        if (newTranslateY < 0) newTranslateY = 0; // ä¸èƒ½å‘ä¸Šæ‹–å‡º
    } else {
        // æ”¶èµ·çŠ¶æ€ä¸‹å‘ä¸Šæ‹‰ï¼šdeltaY < 0
        newTranslateY = closedOffset + deltaY;
        if (newTranslateY < 0) newTranslateY = 0; // é˜²æ­¢æ‹–è¿‡å¤´
    }
    
    panel.style.transform = `translateY(${newTranslateY}px)`;
}, { passive: true });

handle.addEventListener('touchend', (e) => {
    isDragging = false;
    panel.style.transition = 'transform 0.4s cubic-bezier(0.2, 0.8, 0.2, 1)'; // æ¢å¤å›å¼¹åŠ¨ç”»
    
    const endY = e.changedTouches[0].clientY;
    const distance = endY - startY;
    
    // åˆ¤å®šé€»è¾‘ï¼šç§»åŠ¨è¶…è¿‡ 50px åˆ™åˆ‡æ¢çŠ¶æ€
    if (Math.abs(distance) > 50) {
        if (distance > 0) togglePanel(false); // å‘ä¸‹ -> å…³é—­
        else togglePanel(true); // å‘ä¸Š -> æ‰“å¼€
    } else {
        togglePanel(isOpen); // å›å¼¹
    }
});

// ç›‘å¬çª—å£å¤§å°å˜åŒ–ï¼ˆå¤„ç†æ¨ªç«–å±åˆ‡æ¢ï¼‰
window.addEventListener('resize', initMobileSheet);
// é¡µé¢åŠ è½½åå»¶è¿Ÿåˆå§‹åŒ–ï¼Œç¡®ä¿é«˜åº¦è®¡ç®—æ­£ç¡®
setTimeout(initMobileSheet, 100);


/* ----------------- 2. è§†å·®ä¸äº¤äº’ ----------------- */
document.addEventListener('mousemove', (e) => {
    const x = (e.clientX / window.innerWidth) * 2 - 1;
    const y = (e.clientY / window.innerHeight) * 2 - 1;
    document.documentElement.style.setProperty('--mx', x.toFixed(2));
    document.documentElement.style.setProperty('--my', y.toFixed(2));
});

/* ----------------- 3. å·¥å…·å‡½æ•° ----------------- */
function hexToHSL(hex) {
    hex = hex.replace("#", "");
    const r = parseInt(hex.substring(0,2),16) / 255;
    const g = parseInt(hex.substring(2,4),16) / 255;
    const b = parseInt(hex.substring(4,6),16) / 255;
    const max = Math.max(r,g,b), min = Math.min(r,g,b);
    let h, s, l = (max + min) / 2;
    if(max === min){ h = s = 0; }
    else {
        const d = max - min;
        s = l > .5 ? d / (2 - max - min) : d / (max + min);
        switch(max){
            case r: h = ((g - b) / d + (g < b ? 6:0)); break;
            case g: h = ((b - r) / d + 2); break;
            case b: h = ((r - g) / d + 4); break;
        }
        h *= 60;
    }
    return { h, s: s*100, l: l*100 };
}

function rr(a,b){ return a + Math.random()*(b-a); }

/* ----------------- 4. æ ¸å¿ƒç”Ÿæˆé€»è¾‘ ----------------- */
function generateBlobGradient(baseH1, baseH2, useDual, hueVariance) {
    const layers = Math.floor(rr(3, 6)); 
    let gradients = [];

    // çº¿æ€§åº•è‰²
    let bgGradient;
    if(useDual) {
        bgGradient = `linear-gradient(135deg, hsl(${baseH1.h}, ${baseH1.s}%, 90%) 0%, hsl(${baseH2.h}, ${baseH2.s}%, 85%) 100%)`;
    } else {
        bgGradient = `linear-gradient(135deg, hsl(${baseH1.h}, ${baseH1.s}%, 90%) 0%, hsl(${(baseH1.h+40)%360}, ${baseH1.s}%, 85%) 100%)`;
    }
    gradients.push(bgGradient);

    // å†…éƒ¨å…‰æ–‘
    for(let i=0; i<layers; i++){
        let currentBase;
        if (useDual) {
            currentBase = Math.random() > 0.5 ? baseH1 : baseH2;
        } else {
            currentBase = baseH1;
        }

        const h = (currentBase.h + rr(-hueVariance, hueVariance) + 360) % 360;
        const s = rr(60, 95); 
        const l = rr(50, 80); 
        //const l = rr(60, 90); // æé«˜å…‰æ–‘äº®åº¦èŒƒå›´
        
        const x = rr(0, 100);
        const y = rr(0, 100);
        const size = rr(40, 80);
        const opacity = rr(0.5, 0.9);

        gradients.push(
            `radial-gradient(circle at ${x}% ${y}%, hsl(${h},${s}%,${l}% ,${opacity}) 0%, transparent ${size}%)`
        );
    }
    
    return gradients.reverse().join(","); 
}

/* ----------------- 5. å¤åˆ¶ä¸æ¸²æŸ“ ----------------- */
function copyToClipboard(div, gradient) {
    const cssCode = `
background: ${gradient};
border-radius: ${getComputedStyle(div).borderRadius};
box-shadow: inset -5px -5px 20px rgba(0,0,0,0.1), inset 5px 5px 20px rgba(255,255,255,0.4);
    `.trim();

    navigator.clipboard.writeText(cssCode).then(() => {
        const toast = document.getElementById("toast");
        toast.classList.add("show");
        setTimeout(() => toast.classList.remove("show"), 2000);
    });
}

function renderAll() {
    const hex1 = document.querySelector("#colorPicker1").value;
    const hex2 = document.querySelector("#colorPicker2").value;
    const useDual = document.querySelector("#dualColorToggle").checked;
    const baseH1 = hexToHSL(hex1);
    const baseH2 = hexToHSL(hex2);
    const hueVariance = parseInt(document.querySelector("#varianceRange").value);
    const size = document.querySelector("#sizeRange").value;
    
        // ã€æ–°å¢ã€‘ï¼šè·å–æ•°é‡æ»‘å—çš„å€¼
    const count = parseInt(document.querySelector("#countRange").value);
        // æ›´æ–°æ•°é‡æ˜¾ç¤ºçš„æ–‡å­—
    document.querySelector("#countVal").textContent = count;

    document.querySelector("#grid").style.setProperty('--blob-size', size + 'px');
    document.querySelector("#sizeVal").textContent = size + 'px';

    const grid = document.querySelector("#grid");
    grid.innerHTML = "";
    
    for(let i=0; i<count; i++){
        const div = document.createElement("div");
        div.className = "blob";
        const bgStyle = generateBlobGradient(baseH1, baseH2, useDual, hueVariance);
        div.style.background = bgStyle;
        div.onclick = () => copyToClipboard(div, bgStyle);

        /*
        const spinTime = rr(5, 15) + 's';
        div.style.animation = `spin ${spinTime} linear infinite`;
        grid.appendChild(div); 
        */

        /* === ä¿®æ”¹å¼€å§‹ï¼šåŒæ—¶åº”ç”¨æ—‹è½¬å’Œå‘¼å¸ === */
        const spinTime = rr(5, 15) + 's';      // æ—‹è½¬å‘¨æœŸ (5-15ç§’)
        const breathTime = rr(3, 7) + 's';     // å‘¼å¸å‘¨æœŸ (3-7ç§’ï¼Œéšæœºé€Ÿåº¦)
        // å…³é”®ç‚¹ï¼š
        // 1. spin: å§‹ç»ˆè¿è¡Œ
        // 2. var(--breath-anim-name): ç”± CSS ç±»æ§åˆ¶æ˜¯å¦ä¸º 'breathe' æˆ– 'none'
        // 3. ease-in-out: æ¨¡æ‹Ÿç”Ÿç‰©å‘¼å¸çš„æŸ”å’Œæ„Ÿ
        div.style.animation = `spin ${spinTime} linear infinite, var(--breath-anim-name) ${breathTime} ease-in-out infinite`;
        /* === ä¿®æ”¹ç»“æŸ === */

        grid.appendChild(div);
    }
}

/* ----------------- 6. å…¶ä»–äº‹ä»¶ç›‘å¬ ----------------- */
document.querySelector("#dualColorToggle").addEventListener("change", (e) => {
    const wrapper = document.querySelector("#colorInput2Wrapper");
    if(e.target.checked) wrapper.classList.remove("hidden");
    else wrapper.classList.add("hidden");
    
    // å¦‚æœåœ¨æ‰‹æœºç«¯å±•å¼€çŠ¶æ€ä¸‹åˆ‡æ¢ï¼Œé‡æ–°è®¡ç®—é«˜åº¦ä»¥è°ƒæ•´ä½ç½®
    if(window.innerWidth <= 655 && isOpen) {
        setTimeout(() => togglePanel(true), 300); // ç­‰å¾…è¿‡æ¸¡åŠ¨ç”»
    }
    renderAll();
});

document.querySelector("#colorPicker1").addEventListener("change", renderAll);
document.querySelector("#colorPicker2").addEventListener("change", renderAll);
document.querySelector("#varianceRange").addEventListener("change", renderAll);

/* === ã€æ–°å¢ã€‘ï¼šç›‘å¬æ•°é‡æ»‘å— === */
document.querySelector("#countRange").addEventListener("input", (e) => {
    // å®æ—¶æ›´æ–°æ•°å­—æ˜¾ç¤º
    document.querySelector("#countVal").textContent = e.target.value;
});
document.querySelector("#countRange").addEventListener("change", renderAll); // æ¾æ‰‹åé‡æ–°ç”Ÿæˆ
document.querySelector("#sizeRange").addEventListener("input", (e) => {
    document.querySelector("#sizeVal").textContent = e.target.value + 'px';
    document.querySelector("#grid").style.setProperty('--blob-size', e.target.value + 'px');
});

document.querySelector("#diffusionToggle").addEventListener("change", (e) => {
    const grid = document.querySelector("#grid");
    if(e.target.checked) grid.classList.add("diffusion-active");
    else grid.classList.remove("diffusion-active");
});

document.querySelector("#darkModeToggle").addEventListener("change", (e) => {
    if(e.target.checked) document.body.classList.add("dark-mode");
    else document.body.classList.remove("dark-mode");
});
/* === æ–°å¢ï¼šå‘¼å¸å¼€å…³ç›‘å¬ === */
document.querySelector("#breathToggle").addEventListener("change", (e) => {
    const grid = document.querySelector("#grid");
    if(e.target.checked) grid.classList.add("breath-active");
    else grid.classList.remove("breath-active");
});

function regenerate(){ renderAll(); }

/* === ã€æ–°å¢ã€‘ï¼šå¯¼å‡ºå›¾ç‰‡åŠŸèƒ½ === */
function exportImage() {
    const grid = document.querySelector("#grid");
    const toast = document.getElementById("toast");

    // æç¤ºå¼€å§‹å¯¼å‡º
    toast.textContent = "â³ æ­£åœ¨ç”Ÿæˆå›¾ç‰‡...";
    toast.classList.add("show");

    // è·å–å½“å‰èƒŒæ™¯è‰²ï¼ˆç¡®ä¿å¯¼å‡ºçš„å›¾ç‰‡èƒŒæ™¯ä¸æ˜¯é€æ˜çš„ï¼Œè€Œæ˜¯è·Ÿå½“å‰æ·±è‰²/æµ…è‰²æ¨¡å¼ä¸€è‡´ï¼‰
    const computedStyle = getComputedStyle(document.body);
    const bgColor = computedStyle.backgroundColor;

    html2canvas(grid, {
        backgroundColor: bgColor, // å¼ºåˆ¶è®¾ç½®èƒŒæ™¯è‰²
        scale: 2,                 // 2å€æ¸…æ™°åº¦ï¼Œé˜²æ­¢è§†ç½‘è†œå±æ¨¡ç³Š
        useCORS: true,            // å…è®¸è·¨åŸŸï¼ˆè™½ç„¶è¿™é‡Œæ˜¯ç”Ÿæˆå›¾ç‰‡ï¼ŒåŠ ä¸Šä¿é™©ï¼‰
        logging: false            // å…³é—­æ—¥å¿—
    }).then(canvas => {
        // åˆ›å»ºä¸‹è½½é“¾æ¥
        const link = document.createElement('a');
        link.download = 'Fluid-Orbs-' + Date.now() + '.png';
        link.href = canvas.toDataURL("image/png");
        link.click();

        // æç¤ºæˆåŠŸ
        toast.textContent = "âœ… å›¾ç‰‡å·²ä¸‹è½½";
        setTimeout(() => toast.classList.remove("show"), 2000);
    }).catch(err => {
        console.error(err);
        toast.textContent = "âŒ å¯¼å‡ºå¤±è´¥";
        setTimeout(() => toast.classList.remove("show"), 2000);
    });
}
// åˆå§‹åŒ–
renderAll();

</script>
</body>
</html>
